---
- hosts: all
  become: yes
  become_method: sudo
  tasks:
  - name: Create Dir to Downlaod Tomcat. 
    file: path=/opt/SP/apps/tomcat state=directory mode=0755
    
  - name: Install Java 1.8 
    apt: name=default-jdk state=present

  - name: Download Tomcat
    get_url: url=http://apachemirror.wuchna.com/tomcat/tomcat-9/v9.0.31/bin/apache-tomcat-9.0.31.tar.gz  dest=/opt/SP/apps/tomcat.tar.gz mode=0755 

  - name: Extract Tomcat
    command: "tar zxf /opt/SP/apps/tomcat.tar.gz  -C /opt/SP/apps/tomcat --strip-components 1"
    

  - name: Copy bankdata Project War Files
    copy: src=/root/.jenkins/workspace/dev_artifact/bankdata-0.0.1-SNAPSHOT.war dest=/opt/SP/apps/tomcat/webapps/ mode=0644
    
  - name: start Tomcat
    copy: /opt/SP/apps/tomcat/bin/startup.sh
    
  - name: Copy customerdata Project War Files
    copy: src=/root/.jenkins/workspace/qa_artifact/bankdata-0.0.1-SNAPSHOT.war dest=/opt/SP/apps/tomcat/webapps/ROOT1.war mode=0644
    notify: 
    - Restart Tomcat
    

  handlers:
  - name: Restart Tomcat
    shell: /opt/SP/apps/tomcat/bin/catalina.sh start
